\section{Integrating Things}
\label{sec:integration}

% TODO Introducir middleware antes de hablar de él => si no, queda un poco WTF
% 
% En el libro de Coulouris (pag 17):
% Middleware • The term middleware applies to a software layer that provides a
% programming abstraction as well as masking the heterogeneity of the underlying
% networks, hardware, operating systems and programming languages.
%
% Otra del mismo libro:
% The task of middleware is to provide a higher-level
% programming abstraction for the development of distributed systems and, through
% layering, to abstract over heterogeneity in the underlying infrastructure to promote
% interoperability and portability.

The way in which the applications integrate is driven by how the participants communicate.
Coulouris et al. \cite{coulouris_distributed_2012} define two communication styles on the upper layer of a middleware (see Figure~\ref{fig:middleware_layers}): % figura 4.1 modificada para incluir elementos
the remote invocation and the indirect communication.

\InsertFig{middleware_layers}{fig:middleware_layers}{Middleware layers according to Coulouris et al. classification \cite{coulouris_distributed_2012}.}{}{1}{}
% According to Coulouris et al. HTTP is An example of a request-reply protocol!


The \emph{remote invocation} involves the most common two-way exchange between senders and receivers in distributed systems.
In contrast, the \emph{indirect communication} comprehends decoupled communications between senders and receivers.


Within the \emph{remote invocation} style, RESTful style \cite{fielding_architectural_2000} and the well known set of WS-* \cite{alonso_web_2010} standards probably represent the most popular substyles.
In Section~\ref{sec:remote_invocation}, we analyze their application to the Ubicomp field, particularly focusing on the IoT.


% Otros técnicas indirectas:  group communication, publish-subscribe system, message queue systems, shared memory–based approaches
Tuple Spaces, is a type of indirect communication where the entities write data in a persistent space and read specifying patterns of interest.
In Section~\ref{sec:indirect_communication}, we study the most relevant Tuple Space solutions proposed for the ubiquitous computing.



\subsection{Remote invocation}
\label{sec:remote_invocation}

% TODO definir en algun lado que es REST y que es WS-*???

As stated before, RESTful style and the set of WS-* standards are probably the most common remote invocation substyles used currently in the Internet.
Their advantages and disadvantages were extensively discussed by Pautasso et al. \cite{pautasso_restful_2008}.
WS-* web services, also called ``Big Web services'', offer more features such as transactions, reliability or message-level security.
However, they also require further architectural decisions on different layers of the WS-* stack.
These decisions make the people perceive it as more complex than the RESTful style. % CITE


The RESTful style has gained momentum during the last decade as a simpler alternative to services.
REpresentational State Transfer (REST) was designed to build large-scale distributed hypermedia systems,
so it is often used in conjunction with well-known web standards such as HTTP, URI or MIME.
This standards already have many libraries and tools available, which eases the adoption of this style by developers.
Besides, REST naturally integrates with the World Wide Web because it uses the Web as an application architecture instead of as a transport layer as WS-* services do.
% ppios en los que se basa sacados del artículo de pautasso o del blog de Fieldman


\medskip


The use of both substyles in resource-constrained devices is represented by
\textit{Device Profile for Web Services} (DPWS) \cite{moritz_devices_2010}, based on WS-*,
and the Web of Things (WoT) \cite{guinard_internet_2011}. % Mejor poner su tesis?


DPWS defines a subset of WS-* to make it suitable for resource-constrained devices.
%DPWS is claimed to be used in industrial environments.
Its most remarkable features are: decentralized multicast-based discovery, secure message transmission, subscription and event notifications.
Moritz et al. compared DPWS with the REST approach coming to the conclusion that DPWS can be restricted to be fully compatible with the RESTful style.
Even in that case, DPWS will still cover some missing features of the RESTful approach such as eventing and discovery \cite{moritz_devices_2010}.
% no menciono que sean más pesados para cacharros porque no he encontrado un sitio en el que defiendan que DPWS lo es


The \emph{Web of Things} initiative encourages the use of REST-based solutions embedding web servers in daily objects \cite{guinard_internet_2011}.
In this way, the objects can integrate with the WWW as first-class citizens of the Web.
This integration brings the following benefits:
\begin{itemize}
  \item The smart-things can be linked to enable its discovery by browsing. This involves using the tool most users are familiar with: the browser.
  \item They can be bookmarked or shared through social networks \cite{guinard_sharing_2010}.
  \item They can be integrated with other web applications using through mashups \cite{ostermaier_webplug:_2010}. % cita a pintus, stirbu y a todo el mundo
  \item Mechanisms such as searching, caching, load-balancing and indexing can be used over the objects to achieve the scalability of the web. % cita al indio
\end{itemize}


But besides the functional differences, one of the major advantages of REST compared with the WS-* is that is perceived as simpler.
Guinard et al. proved that developers consider it easier to learn and find it more suitable for programming smart things \cite{}.
This makes WoT solutions more popular for resource constrained devices than the WS-* based ones.

% Mencionar un par de trabajos sobre móviles con servidores web embebidos, para que se vea que no es sólo WoT


% mencionar CoAP y demás protocolos?
% A prove of this success/popularity is the raise of new protocols...
% WoT has been leveraged to run in devices as constrained as the ones from the Wireless Sensor Networks.
% The special needs of this kind of sensors has brought the need of new protocols such as CoAP which try to adapt HTTP to UDP environments.

% WoT necesita de Web Semántica, se analizará más tarde



\subsection{Indirect Communication}
\label{sec:indirect_communication}

The indirect communication style comprehends all the techniques with no direct coupling between the sender and the receiver.
The group communication, publish-subscribe systems, message queues or shared memory approaches are examples of indirect communication.
These paradigms are characterized by two key properties \cite{coulouris_distributed_2012}:

\begin{itemize}
 \item \emph{Space uncoupling}, which is achieved when the sender does not need to know the receiver and vice versa.
 \item \emph{Time uncoupling}, which happens when senders and receivers do not need to exists in the same time.
\end{itemize}

% Ojo cuidado porque según esto mi middleware va a dejar de ser time uncoupled! (mirar Figure 6.1 para mayor concrección)
% En esa misma sección aclara que algunas implementaciones no son time-uncoupled.
% por otro lado, asíncronismo != time uncoupling

Tuple Space computing, also called space-based computing, offers an improvement of the shared memory approach.
Whereas the shared memory works at byte-level and accessing to memory addresses,
the Tuple Space works with semi-structured data which is accessed in an associative manner.

% definir si en mayusculas, en minusculas o cómo coño: tuplespace, tuple space, Tuple Space?
Tuple Space (TS) has its roots in the Linda parallel programming language \cite{gelernter_generative_1985}.
In this communication model different processes read and write pieces of information so-called tuples in a common space.
Tuples are composed by one or more typed data fields (e.g. $<"aitor",1984>$ or $<3,7,21.0>$).
The tuples are accessed associatively using a template.
A template provides either a value or type for different fields (e.g. $<String,1984>$ or $<Integer, Integer, Float>$).
The operations over the space are defined by different primitives.
Although the primitives may change from implementation to implementation, the most common ones allow to:

\begin{itemize}
  \item \emph{Access the tuples non-destructively}, using a primitive which is usually called \emph{read} or \emph{rd}.
	This primitive returns a tuple from the space which matches the given template without changing the space.
  \item \emph{Access the tuples destructively}, using a primitive which is usually called \emph{take} or \emph{in}.
	This primitive extracts a tuple which matches the given template from the space.
  \item \emph{Write a new tuple into the space}. This primitive is usually called \emph{write} or \emph{out}.
\end{itemize}

So far, Tuple Space has been adapted to ubiquitous computing by different authors.

% TODO leer artículos que me faltan y corregir
\emph{The event heap} [Johanson and Fox 2004] is a system used for a specific use case. % CITE
In this scenario there are rooms with different devices deployed and where mobile devices can enter.
Each room has its own space where the devices exchanging tuples to cooperate.
For example, a video can be presented in a display and through a remote controller, the user can place the tuple for pausing it.
The display consumes these kind of tuples, so it pauses the video whenever somebody places that tuple on the space.
This system is simple to implement but is limited since it centralizes the space in a single machine per room. % CONFIRMAR ESTO


\emph{L2imbo} [Davies et al. 1998, friday 1999] replicates the tuples to avoid a single point of failure. % CITE
Each node joined to a space uses an IP multicast address to exchange messages with other nodes in that space.
Writing into a space involves sending a multicast message to inform to the rest of the nodes of the tuple written.
Reading operation usually requires local reading.
Destructive reading of the tuple is more complex as it requires a global withdrawal.
Only the owner of a tuple can remove it from the space.
The ownership of a tuple initially belongs to its creator, but can be transferred. % ver qué añadió Friday


\emph{LIME} (Linda in a Mobile Environment) \cite{picco_lime:_1999} is a TS solution for mobile systems.
In LIME each mobile device has its own space where it generally writes its tuples.
This space is shared with other devices creating federated spaces, i.e. the aggregation of different shared spaces.
In this way, each mobile can access to tuples in other mobiles whenever they become available.
They also proposed a new writing primitive to insert tuples in remote spaces.
% ejemplo de service discovery?

This is difficult to implement and some authors complain about the unrealistic assumptions they make to simplify the problem \cite{coulouris_distributed_2012}. % cita al libro
These assumptions are the uniform multicast connectivity between devices whose tuple spaces are aggregated and the serialized and ordered connections and disconnections.
In any case, LIME was adapted to several platforms to run both in embedded and mobile devices \cite{murphy_transiently_2006}.


In the \emph{TOTA} (Tuples On The Air) Project [Mamei and Zambonelli 2009] tuples are disseminated to different devices. % CITE
To that end, each tuple has 3 fields:
1) the content of the tuple,
2) a rule which defines how it should be propagated,
3) a rule to define its maintenance.
For instance, they consider a museum where a visitor writes a query tuple describing a piece of art he wants to see.
The propagation rule defines that it should be propagated to all nodes in the vicinity, increasing the distance by one each time.
The tuple is configured to be deleted after a time-to-live period using its maintenance rule.
When the it reaches the room where the piece of art is located, the piece of art will write a response tuple.
This response tuple jumps from a device to another until it reaches the device which queried for it.


\bigskip

% comparación de todas ellas
% de entre los que ofrecen distribución: este no mola por esto, esto otro mola por esto otro, etc.

Within this solutions, \emph{The event heap} is not considered because of its centralized nature.
Both L2imbo, LIME and TOTA present different ways to disseminate the tuples.
The replication which L2imbo proposes may not be feasible for devices with constrained memory or storage capacity.
Particularly, in spaces populated by many devices like the Internet of Things too many tuples could be generated.
% need to configure the network

TOTA is useful for spatially connected adhoc environments, but it does not seem to suit well on networks where all the nodes can reach each other.
In this case, all the tuples could be replicated on the rest of the nodes showing the same limitations as L2imbo.% COMPROBAR LEYENDO CON ATENCION LO DE TOTA

Finally, despite of their unrealistic assumptions LIME proposes a model where each tuple is responsible of its own part of the space.
They share spaces whenever they become available.

% TODO tabla comparativa? distributed, ad-hoc, federated

\begin{table}%[position specifier]
  \centering
  \begin{tabular}{c|cccc}%p{5cm}}
      ~ & The event heap & L2imbo & LIME & TOTA \\
      \hline
      \hline
      Distributed & No & Yes & Yes & Yes \\
      Goal & x & Availability & Federation & Ad-hoc \\
      % Scalability?
      % Coger propiedades del libro de sistemas distribuidos?
  \end{tabular}
  \caption{Comparison of the most prominent Tuple Space alternatives for ubiquitous computing.} % no columpiarme, o poner todas o ninguna?
  \label{tab:myfirsttable}
\end{table}