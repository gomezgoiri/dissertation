\subsection{\acl{rest}}
\label{sec:rest}

\acf{rest} is a network-based architectural style proposed by \citet{fielding_architectural_2000}.
% descripción de propiedades de REST: hipermedia distribuído
% que es hipertexto? http://roy.gbiv.com/untangled/2008/rest-apis-must-be-hypertext-driven#comment-718
It aims to cover certain properties explained in Section~\ref{sec:network_properties}. % Mencionar que scalability y simplicity destacan sobre el resto?
% Estilos de los que se deriva: ¿?
To achieve these properties, \ac{rest} establishes the following constraints from other network-based architectural styles:
% explicarlo o es demasiado obvio?
% TODO IG no me gusta tanto espacio perdido. Creo que hay formas de cambiar el espaciado a la derecha de los items, pero no lo encuentro.
\begin{description}
 \item[\acf{restcs}.] Providing an \ac{api} to the clients, they are isolated from back-end implementation details.
		       % esto ayuda a: , scalability, evolvability (apps independientes pueden evolucionar mejor)
 \item[\acf{rests}.] The state is fully stored in the client and therefore each request has all the information needed to process it.
 \item[\acf{restcache}.] When added to the \ac{restcs} constraint, this style replicates content obtained from a server in the client.
 \item[\acf{restu}.] It is the key constraint which distinguishes \ac{rest} from other architectural styles.
                      This constraint is composed by the following ones:
    \begin{description}
	% explicados en sección 5.2 de Fielding, resumir?
	\item[\acf{restid}.] Resources are the conceptual targets of hypertext references.
			      Their identification offers a generic interface to access and change the values of a resource.
	\item[\acf{restrep}.] Representations are composed by a sequence of bytes and the metadata to describe those bytes.
	\item[\acf{restdesc}.] The client and server have to agree on standard methods and media types. % linkar al tipo de la Web esa
				% Explicación Fielding:
				% interaction is stateless between requests
				% standard methods and media types are used to indicate semantics and exchange information
				% responses explicitly indicate cacheability.
		                %\ac{http}'s content negotiation for instance, allows to reach an agreement on the media types.
	                        Beyond that point, each request or response should contain all the needed data to process it \citep{wahbe_self-descriptive_2010}.
	                        Therefore, in \citeauthor{fielding_seeking_2006}'s words,
	                        the type should be registered,
	                        the registry should point to a specification and 
	                        the specification should explain how to process data according to its intent \citep{fielding_seeking_2006}. % no necesariamente tiene que ser estándar
	\item[\acf{resthateoas}.] This is a controversial constraint because most of the self-proclaimed ``\ac{rest}'' \acp{api} fail to follow it \citep{moore_hypermedia_2010,house_how_2012}.
	                           It states that no out-of-the-band information should guide the interaction with an \ac{api}.
	                           Instead, the hypertext should guide it.
	                           In other words, the client must know just an initial URL and the application's media types.
	                           From that point, it should select the alternatives proposed by the server to change to the next application state \citep{fielding_rest_2008}.
	                           % propuestas: respresentaciones (links) y la manipulación implicita de las mismas (CRUD)
    \end{description}
 \item[\acf{restl}.] Each layer provides services to the top layer. % e.g. TCP/IP
 \item[\acf{restcod}.] It is the only optional \emph{constraint} in \ac{rest}.
		       It occurs when the client downloads from the server the \emph{know-how} needed to process the set of resources it already has.
\end{description}



\citet{richardson_introducing_2008} came up with a maturity model to help people understand the \ac{rest} principles in a less abstract manner.
Instead of focusing on the presented constraints, the model identifies whether an \ac{api} properly uses the web's three most important protocols: \ac{uri}, \ac{http} and \ac{html}.
Level zero encompasses those \acp{api} which use a unique \ac{uri} and \ac{http} method (i.e. use \ac{http} as a tunneling mechanism).
Level one is formed by the \acp{api} which clearly identify several resources by providing an \acp{uri} to each of them.
Level two uses \ac{http} as it was originally designed for, i.e. using its verbs, status codes, etc. appropriately. 
The correct use of \ac{http} forces a developer to comply with all the \ac{rest}'s constraints except for \ac{resthateoas} \citet{moore_hypermedia_2010}.
Level three comprises the \acp{api} which return resources which describe their own capabilities and are interconnected using preferably standard representations (i.e. those which also address the \acf{resthateoas} constraint).


According to \citet{fielding_architectural_2000} only those in the third level can be considered \ac{rest} architectures.
However, there is a generalized misconception of the \ac{rest} term.
Architectures and \ac{api}s at the first or second level of the \emph{\citeauthor{richardson_introducing_2008} Maturity Model} are often informally (and incorrectly) considered \ac{rest} \citep{fielding_rest_2008,moore_hypermedia_2010,klabnik_nobody_2011}.


% Explicar aquí cosas de nomenclatura:
%     REST o hypermedia API,
%     REST-like (sin HATEOAS)
%     Resource Oriented Architecture o ROA como termino que engloba a ambos
To avoid confusions, we want to clarify the terminology used in this dissertation.
% Si, esto de ortodoxo o heterodoxo 
To adhere to the precise meaning of \ac{rest}, we consider orthodox architectures concrete instantiations of \ac{rest} and heterodox ones \ac{rest}-like architectures.
In other words, in the scope of this dissertation, \ac{rest}-like architectures are those described by second level of the \emph{\citeauthor{richardson_introducing_2008} Maturity Model}.
% Resource-oriented architecture (ROA) es una instanciación de RESTful sobre HTTP definida por Richardson y Ruby en su libro "RESTful Web Services"
%    defienden que como tal el estilo RESTful, se puede aplicar a cualquier cosa que no sea HTTP
%    Al hacer la presentación del "Richardson Maturity Model", el tipo reconoció que en su libro sólo había comprendido 2 de los 3 requisitos (no HATEOAS o usar bien HTML).
%     Así que técnicamente, podríamos decir que ROA si que es el nivel 2
%     En cualquier caso, por evitar complicaciones no lo menciono.
Recently, the \emph{Hypermedia \ac{api}} term has emerged to refer to \acs{http} \ac{api}s which fully comply with all the \ac{rest} principles \citep{klabnik_rest_2012,moore_hypermedia_2010,amundsen_building_2011}.  % (particularly, with \ac{resthateoas}).
We will indistinguishably refer to them as \ac{rest}ful \ac{api}s or as \emph{hypermedia \ac{api}}s.



\subsubsection{\ac{rest} vs WS-* services}
\label{sec:protocols}

% Guinard se refiere apostilla al concepto WS-*:
%    (nada), services (lo que más), Web services, approach, standards, galaxy of standards, implementation, applications
WS-* \citep{newcomer_understanding_2002,alonso_web_2010}, also called ``Big Web services'', together with \acs{rest}ful architectures are probably the most common remote invocation substyles currently used in the Internet.
% Usando descripción de newcomer_understanding_2002 que me ha dejado ver Google :-P
\ac{uddi} defines how to discover these \emph{big web services} using registries.
A registry returns information to point to the web services' interfaces.
These interfaces are syntactically described using the \ac{wsdl}.
Additionally, \ac{wsdl} describe data and message types, interaction patterns and protocol mappings.
Using this information, the service consumer and provider communicate through messages encapsulated using \ac{soap}.


WS-* standards offer more features than the \ac{rest} such as transactions, reliability or message-level security.
Besides, they have been adapted to the needs of resource-constrained devices in the \ac{dpws} specification\footnote{\url{http://docs.oasis-open.org/ws-dd/ns/dpws/2009/01}}.
This specification defines a minimal set of implementation constraints.
\ac{dpws}'s most remarkable features are: decentralized multicast-based discovery, secure message transmission, subscription and event notifications \citep{moritz_devices_2010}.


% la web implementa los principios de REST y WS-* no
Note that although the web implements \ac{rest}'s principles and WS-* can contradict them
\footnote{Interestingly, \citet{moritz_devices_2010} came to the conclusion that \ac{dpws} can be restricted to be fully compatible with the \ac{rest}ful style and still cover some missing features (e.g. eventing and discovery).},
WS-* stands for \emph{web services}. % citas a What's wrong with the web y demás papers que explicaban esto
% a WS-* se le llama web  porque usa estándares de esta
The reason for this is that it employs web standards. % (e.g. \ac{http}, \ac{uri} or \ac{mime}) <-- o los que fuesen
% esto es porque WS-* usa protocolos con propositos distintos a los que fueron diseñados
However, WS-* uses some of them in ways they were not designed for \citep{krummenacher_www_2005}.
% ejemplo de HTTP
The most paradoxical case is how it uses \ac{http} as a transport layer instead of as an application layer protocol.
% por eso no consigue las propiedades de REST: simplicidad y escalabilidad
This prevents the resulting architectures from achieving some of \ac{http}'s desirable properties such as scalability or visibility.
% se podría decir que las sacrifica en pro de features adicionales
In other words, it sacrifices some of the web's properties on behalf of additional features.


% posiblemente esa simplicidad se ve afectada negativamente porque los usuarios necesitan decidir
One of the sacrificed properties is the simplicity.
The complexity negatively affects to
(1) the ability of limited computing platforms to adopt the WS-* stack; and % explicar esto más? => cuanto menos requieras, más fácil que alguien haya implementado HTTP y eso
(2) the developers.
% y por eso o no, WS-* está perdiendo peso respecto a REST
Specifically, developers need to take further architectural decisions on different layers of the WS-* stack.
These decisions make the people perceive it as more complex than the \ac{rest}ful style \citep{guinard_search_2011}.
This perception influences the adoption of \ac{rest} on behalf of WS-* \citep{davis_perceived_1989,legris_why_2003}.
% This acceptance also results in a massive availability of libraries in most of the computing platforms.


% Nosotros elegimos el segundo por sus propiedades, pero también por su relevancia actual.
% Guinard en la página 91 de su tesis pone citas que dicen que la aceptación de algo depende de su facilidad de uso.
In fact, besides technical considerations
\footnote{For an extensive analysis on the advantages and disadvantages of \ac{rest} and WS-*, we refer the reader to \citep{pautasso_restful_2008} and \citep{guinard_search_2011}.},
\ac{rest}'s acceptance is a powerful practical motivation for focusing on it.
% Al final, si queremos facilitar que lo nuestro se integre con otros elementos, que mejor que usar su mecanismo de integración.
In the end, seamlessly integrating with a higher number of applications seems to be a logical choice if one of the middleware's goals is to reuse other applications' data. % TODO no tengo datos para decir que esto sea así!
% Es difícil predecir cual ganará o cual será más popular, pero la web lleva ahí desde hace 20 años.
Although this acceptance level is subject to changes in the future, the life of the web backs \ac{rest} as a long-term choice.
% Cita de Fielding:
Or in \citeauthor{fielding_architectural_2000}'s words \cite[comment 21]{fielding_rest_2008},
``\emph{REST is intended for long-lived network-based applications that span multiple organizations}''.



\subsubsection{Suitable Protocols for \ac{rest}}
\label{sec:protocols}
% hablar un poco de HTTP y CoAP y decir por qué no hablamos más a menudo de CoAP

% sólo por el correcto uso de ciertos protocolos se puede conseguir todo menos HATEOAS => citar el vídeo aquel
Although an \ac{api} does not adhere to the \ac{rest} style just because it uses certain protocols,
the correct use of some of them can help to achieve most of its principles \citep{moore_hypermedia_2010}.
Historically, \ac{http} has been considered a suitable protocol in that regard.
% Trampa: no cito estadísticas, cito trabajos que lo han ejecutado en plataformas pequeñas
% No sé si citar trabajos como TinyREST o alguno de los que hacen un gateway a HTTP o modifican el protocolo.
%    Ver aquí: http://en.wikipedia.org/wiki/Comparison_of_lightweight_web_servers
%    Podría referirme a algún servidor web más, siempre que se haga enfasis en que se usa en plataformas limitadas/raras
\ac{http} is a simple protocol which has be adopted by a wide range of computing platforms \citep{yazar_efficient_2009,hammel_mongoose:_2010}\footnote{\url{https://github.com/sirleech/Webduino}}. % TODO arreglar esto


However, in the last few years \acf{coap}\footnote{\url{https://datatracker.ietf.org/doc/draft-ietf-core-coap/}} has emerged as a specialized web transfer protocol for resource constrained devices. % has emerged, has arisen?
Some noteworthy features of \ac{coap} are
(1) the reduced message size,
(2) the use of UDP as a transport layer (with the possibility of using \emph{multicast} communication),
(3) similarity with \ac{http} (both to reuse its properties and to ease cross-protocol proxying), and
(4) a resource discovery mechanism. % TODO comprobar a ver de dónde cojones saque esto último => no estoy seguro
% mencionar seguridad?


One could argue that to implement a lightweight \ac{tsc} solution, \ac{coap} should be used as a baseline.
However, we have chosen to work with \ac{http} for the following reasons:
\begin{itemize}
  \item Direct interoperation with other web-solutions.
        %Most of the Internet-based \ac{api}s use \ac{http}.
        Directly using \ac{http} we can avoid proxies.
        Proxies may introduce latency in the response time degrading network performance. % siempre degradará la eficiencia algo, pero habría que verlo y testearlo, la verdad...
        % será cierto? o tardará menos en conjunto?
  \item \ac{rdf}-based media-formats can be rather verbosed.
	This contrasts with \ac{coap}'s message size limitations.
	Dealing with this limitations was not one main goals of the thesis.
	However, we have considered them at some points of the dissertation to avoid unrealistic assumptions.
  \item \ac{coap} is an ongoing standard (i.e. its definition is currently subject to change).
        As a result of this immaturity, there are few libraries and tools to work with \ac{coap} at the moment \citep{villaverde_constrained_2012}. % y encima cada una en una versión...    
        This limits the range of platforms which could adopt any proposed solution. % practical limitation
\end{itemize}


Nevertheless, due to \ac{http}'s similarities with \ac{coap}, the future adoption of the latter should be relatively straightforward.

% Ideas no usadas:
% REST no dice nada, pero de facto el protocolo es HTTP
% durante el desarrollo de esta tesis en resource constrained ha surgido CoAP
%   muchas de las cosas aquí comentadas son iguales o mejor sobre CoAP
%   de todas formas, ha habido algo que ha guiado nuestro diseño: librerias existentes => afecta a plataformas
%         si, pero para eso está lo de layered approach! => motivos prácticos