\section{REST Actuation}
\label{sec:direct_actuation}


The actuation technique presented in the previous section uses the \Space{} (i.e. it is indirect).
This technique implies that the actuator must be aware of the \Space{}'s content.
For instance, a heater must check the space to find if a new desired temperature was written.
% lo podrá reusar a través de un intermediario
% interop era una de las cosas que queriamos cuidar
% y qué pasa con las soluciones REST que quieren usar lo nuestro?


% por qué? motivación: permitir a otras app integrarse en nuestro espacio
In contrast, this section presents a second technique which directly actuates in the environment without using any \Space{}.
A consumer following this technique directly uses \ac{rest} \acp{api}. % i.e. it is the client of these \ac{api} <-- se entiende esto o hace falta dar el salto entre consumer y client?
These \acp{api} expose the devices' capabilities to make physical changes in the environment.

However, this apparently simple mechanism hides a difficulty: the consumer needs to discern how to use these \acp{api} to make such changes.
According to the \ac{rest} principles, a client should navigate through the resources of an \ac{api} with no prior knowledge of it.
% Copiar esta explicación mejor de algún lado:
The client should 
\begin{enumerate*}[label=\itshape(\arabic*\upshape)]
  \item interpret the representations provided by the server and then
  \item choose the appropriate state transition from the hypertext according to its intention. % y su conocimiento básico del protocolo: CRUD
\end{enumerate*}
To do this, this section advocates for a semantic description of these \acp{api}' resources.

Section~\ref{sec:actuation_rest_background} briefly compares different alternatives to build semantic \ac{rest} \acp{api}.
Section~\ref{sec:restdesc} presents the selected alternative and Section~\ref{sec:actuation_scn2} implements the baseline scenario using it.



\subsection{Background}
\label{sec:actuation_rest_background}

As Section~\ref{sec:network_properties} explained, semantic representations do not include a native way to express the hypertext. % TODO realmente se explica?
To solve this, three solutions can be adopted:
% Unos proponen extender con ontologías
\begin{enumerate}
  \item To use an ontology to represent the hypertext \citep{kjernsmo_necessity_2012}.
  \item To embed the hypertext independently to the representations on the \ac{http} headers \citep{mark_web_2010}.
  \item To provide a description of the state changes each \ac{http} request triggers \citep{verborgh_functional_2012,verborgh_ijcs_2014}.
\end{enumerate}


The latter two enable to discover resources and state transitions without adding metadata to the representations.
This allows not only to describe semantic representations, but any type of formats.


\citeauthor{mark_web_2010}'s \citep{mark_web_2010} approach is extended by \citet{erik_profile_2013} to define how to embed additional semantics to process a resource representation.
\citet{erik_profile_2013} calls these additional semantics \emph{profiles} and identifies them using \acsp{uri}.


\citet{verborgh_ijcs_2014} present a more expressive solution which goes beyond simply describing the resource's type.
It also allows to semantically describe the knowledge needed to use a concrete \acs{http} verb on a resource, and the content this request returns. % o precondition
The materialization of this proposal is called \restdesc{} \citep{verborgh_functional_2012}.
\citet{mayer_semantic_2013} use \restdesc{} in an environment populated by web-powered devices. % i.e. the \ac{wot}
This environment is analogous to the ones envisioned by this dissertation. % analogous/equivalent


\bigskip


We consider \restdesc{} the best current solution which helps to achieve truly \ac{rest}ful \acsp{api}.
Therefore, this chapter assumes that the \ac{http} \acsp{api} whose capacities we want to reuse in our space model describe their \acsp{api} with \restdesc{}.


\subsection{\restdesc{}}
\label{sec:restdesc}

% TODO mirar si tiene cabida la mención de otros enfoques para describir recursos que no son muy RESTful
%Different ways exist to describe \ac{rest} services. % mencionar WADL, etc.?
% citar a donde se hable de \restdesc{} y así ya se empieza a explicar la solución de forma discreta.
\restdesc{} describes \acs{http} methods using rules expressed in the \ac{n3} language \citeweb{n32011}.
% he evitado explicar que las reglas tienen premisa y conclusión, porque me parece demasiado obvio
A rule's \emph{premise} expresses the requirements to invoke a \ac{rest} service.
A rule's \emph{conclusion} expresses both the \ac{rest} call that needs to be made and the description of that invocation result.


\citet{verborgh_functional_2012} suggest three complementary alternatives to discover descriptions.
The first and second alternatives use \ac{http} mechanisms: the content negotiation and the \ac{http} OPTIONS verb.
Using the content negotiation a client can obtain a dereferenceable link's representation which corresponds to the description. % puede ser comments#algo
Requesting a resource using the \ac{http} OPTIONS verb a client can obtain the description in the response body.
Finally, the third alternative is not \ac{http}-centric and it depends on repositories to store and retrieve the descriptions.
% En el paper los autores no justifican bien porque es last resort, así que paso de meterme yo en berenjenales
% This alternative should only be used as a last resort because it requires out-of-band information (e.g. the repository address and how to use it) to learn how to use an \acs{api}.
% it separates the description of the \acp{api} functionality from the \acp{api} themselves. % dificultando el descubrimiento de las APIs usando sólo ellas


\citet{verborgh_ijcs_2014} propose a service composition mechanism for Web \acp{api} using \restdesc{}.
This mechanism uses as inputs:
\begin{enumerate*}[label=\itshape(\arabic*\upshape)]
  \item an initial state,
  \item a goal state,
  \item Web \ac{api} descriptions using \restdesc{}, and
  \item optional background knowledge.
\end{enumerate*}
Each of these inputs are semantically expressed and therefore, they can be processed by standard \ac{n3} reasoners.
These reasoners generate proofs about how to achieve the goal starting from the initial state and using the rest of the inputs.
These proofs can be seen as steps that need to be made to reach a desired state.


Additionally, \citeauthor{verborgh_ijcs_2014} distinguish between pre-proof and post-proof.
The first, are those which assume that the execution of all \acs{api} calls will behave as expected.
The latter, can be seen as a \emph{revision} of the pre-proof.
It executes the Web \acs{api} of the pre-proofs and uses actual execution results to generate a new proof.


\subsection{Baseline Scenario: Implementation 2}
\label{sec:actuation_scn2}
\newcommand{\implRest}{\emph{Implementation 2}}

% poner un diagrama que presente el escenario?
% En ppio no, porque sería muy sencillote, y el flujo del consumidor que es el complejo ya ha sido explicado.
The proposed implementation for the baseline scenario using \restdesc{} presents the following nodes:
\begin{enumerate}[resume,label=\itshape(\Alph*\upshape)]
  \setcounter{enumi}{\theenumNodes}
  \item A node which exposes the lamp and its actuators through a \ac{rest} \ac{api}.
	This \ac{api} is described using \restdesc{}. % REST API seguro 100%? por si acaso decir HTTP API?
	To physically change the light value, any client must send an \acs{http} request to the resource which represents the light actuator.
	% Please note that \nodeProvRest{} is omitted because its operation is the usual for an \acs{http} server.
	
  \item A node which directly communicates with the desired provider.
	To discern which provider's resources has to call and how to do it, this implementation reasons to obtain a plan.
	This plan determines how to fulfil the node's initial goal invoking the needed \ac{http} \acsp{api}.
	Figure~\ref{fig:flow_rest_prov} shows the actions performed by this node in detail.
\end{enumerate}

% In advance, we will refer to these nodes as "C" and "D" using the following commands:
\newcommand{\nodeProvRest}{\emph{Node C}}
\newcommand{\nodeConsRest}{\emph{Node D}}


\InsertFig{flowRESTConsumer}{fig:flow_rest_prov}{
  Flow chart for the \nodeConsRest{}.
}{
}{0.5}{}


The \acs{http} \acs{api} provided by the \nodeProvRest{} is modelled using the following resources:
\begin{itemize}
  \item \emph{/lamp}: It provides basic information about the lamp.
  \item \emph{/lamp/actuators}: It enumerates the actuators which compose the \emph{smart lamp}.
  \item \emph{/lamp/actuators/light}: It represents the unique actuator which composes the lamp in our simple example (i.e. the lamp's light).
  \item \emph{/lamp/actuators/light/01}: It represents a concrete preference to change the light.
\end{itemize}


% Aquí estoy explicando un poco el diagrama de flujo de la figura,
% dando detalles de cómo se ha implementado y a qué me refiero con cada pieza de información
% ¿Añadir descripciones y demás aquí o ponerlas como anexo?

In order to instruct consumers on how to use the services provided, they are annotated using \restdesc{}.
The \acs{http} OPTIONS returns listings~\ref{lst:light_descpost}~and~\ref{lst:measure_descget} for \emph{/lamp/actuators/light}.
Thanks to these descriptions and to the dereferenceable \acsp{uri} \citep{sauermann_cool_2008}, starting from \emph{/lamp} any client can crawl the \acs{api} to autonomously learn how to use it.

\begin{listing}
  \input{\pathchapsix/code/scn1/measure_descget.tex}
  \caption{Rule which expresses that having a light sensor observation, one can obtain details about the observation through an \acs{http} GET.}
  \label{lst:measure_descget}
\end{listing}

\begin{listing}
  \input{\pathchapsix/code/scn1/light_descpost.tex}
  \caption{Rule which expresses that having a preference which is measured in luxes, one can create a light observation using the \acs{http} POST.}
  \label{lst:light_descpost}
\end{listing}


In addition to the crawled content, the \nodeConsRest{} provides two extra pieces of information to the reasoner: a preference and a goal (see listings~\ref{lst:additional_information} and~\ref{lst:light_goal}).
The preference allows the consumer to express the interest on changing a resource, which may not always be feasible.
The goal drives the reasoning process, which tries to extract a plan to achieve it.

\begin{listing}
  \input{\pathchapsix/code/scn1/additional_info.tex}
  \caption{A preference which expresses the interest on modifying the sensed value of a light.}
  \label{lst:additional_information}
\end{listing}

\begin{listing}
  \input{\pathchapsix/code/scn1/light_goal.tex}
  \caption{A goal which expresses the interest on modifying the value for a light.}
  \label{lst:light_goal}
\end{listing}

With this plan, the consumer just needs to call to the different \acs{http} resources it defines.
If more than a resource needs to be called, the plan may also indicate how to use the information obtained from one to use it in the next call.