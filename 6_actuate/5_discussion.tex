\section{Discussion}
\label{sec:actuation_discussion}


In the previous section we presented how the space-based approach can interoperate with semantically described \ac{rest} services.
The space-mediated communication transparently invokes \ac{rest} services on behalf of the consumer which follows the \ac{ts} usage patterns.
This section scrutinizes the strengths and weaknesses of the presented design, in conjunction with some other design alternatives. % design, alternative, etc.


% TODO poner aquí algunos indicadores de la implementación de escenarios?
%   e.g. cuando código extra ha hecho falta añadir en el tercero para que se hablen entre sí


\subsection{Actuation Abstraction Level}

% explain why like this? why not directly sensors/light?
The most abstract way to act on the environment would be to directly actuate on a sensed value (e.g. stating ``set the \emph{room A} light-level to 19 luxes'').
This would require the coordination of all the actuators which directly or indirectly affect this value (e.g. all the lamps of a room).
Furthermore, even in this case, many other physical aspects would affect the value (e.g. the daylight at each time).
As a consequence, we opt for clearly distinguishing between actuators and sensors.
In our scenarios, the data measured by the sensors can only be indirectly affected by the actuators.


This indirect effects on the sensed values could be modelled for each actuator.
For example, to state that turning on a lamp increases the light measured by a sensor.
However, precisely anticipating the exact value of the new measure is difficult if not impossible due to the mentioned external physical conditions.
Considering this difficulty to predict their relationship and its tangential importance for the scenario, we simply ignore these relationships.


\subsection{Knowledge Model}

% Ontologies used
% explicar por qué hemos modelado así los escenarios?
The \emph{glue} between the two actuation worlds presented in Section~\ref{sec:actuation_interoperation} is the data they use. % o between both approaches, o yo qué sé
Therefore, it must be modelled according to the same ontologies.
This section provides the rationale behind the selection of the ontologies we used.
Note that this selection does not pretend to be best or unique alternative.

% por qué con medidas?
To represent the value of a lamp actuator, we use the SSN ontology \citeweb{ssn}.
The SSN ontology is intended to describe measures for sensors, so its use for actuators may sound contradictory.
However, for the best of our knowledge, there is no more widely-accepted ontology to specifically describe actuators.
Therefore, with this model we transmit things like ``the lamp actuator has a light value of \emph{N} luxes''.
Note the difference with an order like the following ``the light sensed by a sensor located in the lamp has a value of \emph{N} luxes''.


% por qué uso preferencias?
Finally, there is the other core ontology in our scenario implementations: the preferences ontology.
It is used to clearly distinguish between the value of an actuator and a consumer's intention or desire to change it.
A preference can turn into an actuator's new state, but it is not always necessarily true.
The actuator can discard a preference because of some policies, a malfunction or any other reason.

% por qué no se tienen en cuenta otras características como la localización o lo que sea => por simplificar
%   en el goal se podrían describir


\subsection{Obtaining Resource Descriptions}

The core of the proof-based actuation mechanisms are the descriptions.
They must be read from the actuation nodes prior to reasoning. % obvio
This action corresponds to the consumer in the first scenario and to the agent which resides in the \Space{} in the third scenario.

In both cases, they crawl over a given \ac{api} starting from a \ac{url}.
The discovery of the \ac{url} is out of the scope.
% Otra alternativa: An agent could discover the descriptions and simply write them in the coordination \Space{}.


Another alternative to discover this descriptions is to make them part of the \clues{} presented in Chapter~\ref{cha:searching}.
This option ensures that they will be available in any \consumer{}.
Besides, the static nature of these descriptions does not break the stability assumption of the \clues{}. % explicar más?


In any case, this chapter focuses on the interoperability problem, not on how to obtain the description.
Consequently, we opted for the most simple alternative: the first one. % para no liar


\subsection{Weaknesses}

% qué pasa si el consumidor del escenario 2 no se suscribe a los resultados?
% qué pasa si se suscribe a un patrón más general?



\subsection{Inputs for the Proof-based Actuation Mechanism}
\label{sec:inputs_proof}

The reasoning process presented by \citet{verborgh_ijcs_2014} uses as inputs: % presented by en vez de posesivo, porque "X et al.'s" queda como el culo
an initial state,
a goal state,
Web \ac{api} descriptions using \restdesc{}, and
optional background knowledge.
% inputs: clues
% goal: task


\begin{description}
  \item[The descriptions] must be read from the actuation nodes prior to reasoning. % obvio
        They can be read with a \emph{ad hoc} discovery mechanisms.
        However, in order to simplify the design of the middleware, it is sensible to use one of the already existing mechanisms:
        
        \begin{itemize}
	  \item An agent could discover the descriptions and simply write them in the coordination \Space{}. % y ahora habrá que definir que es un agente?
		Then, any node willing to reason will read them from the \Space{}.
	  \item The descriptions could be part of the \clues{} presented in Chapter~\ref{cha:searching}.
		This option ensures that they will be available in any \consumer{}.
		Besides, the static nature of these descriptions does not break the stability assumption of the \clues{}. % explicar más?
        \end{itemize}

  % TODO TODO TODO especificar que este mecanismo adicional de usar clues es optional y no el usado en nuestro escenario simple
  \item[The initial state and background knowledge] can be acquired both from the coordination space and the outer space.
	However, reading all the space would be highly inefficient.
	To reduce readings on the space (i.e. network usage), we propose a procedure composed by two reasoning steps.
	In the first one we only use local incomplete knowledge derived from the \clues{}.
	Then, we read from the \Space{} just the knowledge needed to confirm the pre-proofs obtained in the first reasoning.
	The second reasoning uses this knowledge to get real pre-proofs. % real o actual pre-proofs
	
	% Y ahora explicado en mayor detalle:
	Therefore, a node which wants to actuate over the space will need to obtain the \emph{clues} from the \ac{wp}.
	%These clues, as explained before, tell what kind of content other nodes provide. % un poco redundante
	Let us assume that these \emph{clues} are composed by the predicates used by the nodes which provide content. % es una de las alternativas que se planteaban
	The existence of a predicate used in a premise does not necessarily imply that this rule can be used.
	Nevertheless, its absence does imply that it will not be used (see Figure~\ref{fig:activation_rules}).
	Therefore, we can create temporary \emph{activation rules} from \clues{} which activate those potential rules. % latter rules las que se han mencionado primero

	\InsertFig{activation_rules}{fig:activation_rules}{
	  Sample clues, two rules and the activation rule created from the first rule.
	}{
	  According to the clues shown, the second rule will never be invoked.
	}{0.8}{}

	An \emph{activation rule} for a rule R contains a \emph{true} in the premise.
	The conclusion is made by R's premise substituting the variables with fictitious \acsp{uri} with a common prefix (see Figure~\ref{fig:activation_rules}).
	These fictitious \acsp{uri} are used to distinguish when a triple should be replaced by actual knowledge from the space. % explicar mejor?


  \item[The goal state] should be created from the task to reuse the primitives and the data from the \ac{ts}-based actuation mechanism.
	For instance, from a task of \emph{regulate temperature to 6ºC} we can deduce the goal state of \emph{temperature of 6ºC}.
	This translation is out of the scope of the dissertation.
\end{description}


\subsection{Responsibility for Triggering the Proof-based Actuation Mechanism}
\label{sec:responsible_proof}

Section~\ref{sec:background_restdesc} described two coarse-grained steps:
\begin{itemize}
  \item Reasoning over the descriptions, background knowledge, an initial state and a goal state.
        The result of the reasoning process if a pre-proof, which can be seen as a tentative \emph{execution plan} to achieve the goal.
  \item Check the execution plan by following it.
\end{itemize}


This mechanism can be performed by any node.
% no obligamos a implementar una u otra, pero recomendamos esto: XXX
This dissertation briefly explains three different alternatives and their trade offs.
However, we do not adhere to any of them.
We leave as a future work to implement and quantitatively compare them.

\begin{enumerate}
  \item An agent which resides in the same machine as the \emph{coordination space} can trigger the process. % TODO buscar su nombre bueno
	Doing so, it can locally consume the knowledge available in the \emph{coordination space}.
  \item A more flexible approach would consist of letting any \consumer{} interested on changing the environment to trigger it.
	If these \consumers{} use the search mechanism presented in the Chapter~\ref{cha:searching}, they will have background knowledge about other nodes.
	This reduces the dependency on the node providing the \emph{coordination space}. % TODO buscar su nombre bueno
	However, it requires them to perform tasks such as reasoning and checking the pre-proofs.
	While the latter increases the network usage, the first increases the computation.
	As we already mentioned in previous chapters, these tasks severely affect to the energy consumption.
	Furthermore, some resource platforms will not be even able to reason.
  \item To mitigate that problem, we could delegate this task only on the nodes able to perform such tasks.
	In fact, these nodes could follow the \emph{replicated-worker pattern}.
	They could read from the space goals to trigger the process (i.e. \emph{reasoning tasks}).
	Apart from balancing the load between all the worker nodes, any node can stop being worker at any time by not taking more \emph{tasks} (e.g. if it has low energy).
	These nodes must be \consumers{} to use the \clues{} from the search mechanism as background knowledge.
\end{enumerate}


% Poner ejemplo adaptado del paper de WoT2013?


%Proceso de suggest:

%\begin{itemize}
% \item obtener todo el conocimiento necesario para el proceso?
% \item razonamiento sobre conocimiento
% \item parsear el resultado para invocar servicios HTTP
% \item monitorizar que se ha complido el cambio?
%\end{itemize}