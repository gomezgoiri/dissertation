\section{Interoperation between Actuation Approaches} % Usage of \acs{rest} \acsp{api} from \acs{tsc}}
\label{sec:actuation_discussion}

The actuation technique presented by Section~\ref{sec:actuation_space} constitutes the natural way of acting using a \Space{}.
However, \ac{rest} and \ac{rest}-like services constitute an emerging mechanism to directly actuate in the physical environment.
Therefore, their seamless integration opens the door to reuse the capacities of many existing devices. % interoperate
Consequently, we aim to integrate semantically described \ac{rest} services (i.e. the actuation technique presented in Section~\ref{sec:direct_actuation}) in our space-based model. % integration, reuse, alignment, close the gap
% we first need to close the gap between both approaches.
%This section aims to experimentally proof the validity of the alignment presented in the previous section.


This section explores this integration helped by the baseline scenario.
Section~\ref{sec:actuation_scn3} presents a new implementation which mixes the nodes from the implementations presented in sections \ref{sec:actuation_scn1} and \ref{sec:actuation_scn2}.
This implementation shows how the \Space{} can transparently invoke \ac{rest} services on behalf of any consumer following the \ac{ts} usage patterns. % esto es, discussion
%This lead us to analyse the adjustments required to enable their interoperation.


\subsection{Baseline Scenario: Implementation 3}
\label{sec:actuation_scn3}
\newcommand{\implMix}{\emph{Implementation 3}}

This implementation aims to proof that our space-based middleware can easily reuse third applications' providers capacities. % easily? transparently?
It presents the space and the consumer (i.e. \nodeConsSpace{}) from the \implSpace{}, but it replaces the provider with the one from the \implRest{} (i.e. \nodeProvRest{}).
Both nodes have a good foundation for the interoperation because they use the same vocabularies. % to describe the knowledge they manage.
However, the \nodeProvRest{} and the \nodeConsSpace{} rely on different communication mechanisms: direct communication and indirect communication.


To close the gap between both worlds, we avoid changing the participant node's implementations.
Instead, we create an agent which acts on the consumers' behalf. % TODO Yo he entendido que se sobreentiende qué es un agente
% WIKIPEDIA: which derives from the Latin agere (to do): an agreement to act on one's behalf
This agent resides in the same machine as the \Space{}, but it existence must not interfere with the \Space{} one. % dificil explicar en qué terminos: es otro proceso
Therefore, it should run on an independent process.


The agent takes care of the tasks that \nodeConsRest{} does in the \implRest:
\begin{enumerate*}[label=\itshape(\arabic*\upshape)]
  \item crawls the discovered \acsp{api}\footnote{The discovery process is out of the scope of this implementation.},
  \item reasons about their data to get a plan, and
  \item follows the resulting plan performing \acs{http} requests.
\end{enumerate*}


To trigger the reasoning, the agent awaits for new tasks written in the space.
Listing~\ref{lst:generic_task_subscription} shows the subscription template used by the agent.
Providing that after reasoning the agent does not find a plan to achieve a task, it will write it in the space again.
This way, another node which may know how to process it may take the task. % TODO discutir porque reasoning va a tener preferencia sobre actuación indirecta!


\begin{listing}
  \input{\pathchapsix/code/scn3/generic_task_subscription.tex}
  \caption{Subscription to any task written into the space.}
  \label{lst:generic_task_subscription}
\end{listing}


Requiring new data from the developer, would impede the transparent reuse of the nodes from \implSpace{} and \implRest{}.
Therefore, the agent reuses all the information pieces it needs:
\begin{itemize}
  \item It uses the \nodeConsSpace{}'s subscription to the task result as a goal for the reasoning.
	In our implementation, this correspondence needs a minimal mapping between N3QL \citeweb{n3ql2004} and SPARQL \citeweb{sparql2008}.
	The reason why we use both languages are the underlying frameworks: EYE \citeweb{euler} and RDFLib \citeweb{rdflib}.
	% TODO Justificar?
	
  \item The agent uses all the content written into the space as \emph{additional knowledge} for the reasoning process.
	This is feasible because it can locally obtain it because the agent resides in the same machine as the space.
	Otherwise, obtaining this knowledge through the network would be too consuming both in bandwidth and in time.
\end{itemize}


% TODO poner aquí algunos indicadores de la implementación de escenarios?
%   e.g. cuando código extra ha hecho falta añadir en el tercero para que se hablen entre sí